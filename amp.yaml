---
- id: amp_main
  execute-command: '{{ getenv "SCRIPT_DIR" }}/build_main.py'
  command-working-directory: '{{ getenv "TMPDIR" }}'
  pass-arguments-to-command:
    - source: payload
      name: repository.name
    - source: payload
      name: head_commit.id
    - source: payload
      name: pusher.name
    - source: payload
      name: pusher.email
  trigger-rule:
    and:
      - match: 
          type: payload-hmac-sha1
          secret: '{{ getenv "SECRET" }}'
          parameter: 
            source: header
            name: X-Hub-Signature
      - match: {type: regex, regex: "^refs/heads/(master|main)$",
                parameter: {source: payload, name: ref}}
- id: amp_release
  execute-command: '{{ getenv "SCRIPT_DIR" }}/build_release.py'
  command-working-directory: '{{ getenv "TMPDIR" }}'
  pass-arguments-to-command:
    - source: payload
      name: repository.name
    - source: payload
      name: head_commit.id
    - source: payload
      name: pusher.name
    - source: payload
      name: pusher.email
  trigger-rule:
    and:
      - match: {type: payload-hmac-sha1, secret: '{{ getenv "SECRET" }}', 
                parameter: {source: header, name: X-Hub-Signature}}
      - match: {type: value, value: refs/heads/release,
                parameter: {source: payload, name: ref}}
